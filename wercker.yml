box:
 id: node:latest
 ports:
   - "3000"

build:
  steps:
    - npm-install
    - script:
      name: copy source
      code: |
        cp -a . ${WERCKER_OUTPUT_DIR}
        ls -l ${WERCKER_OUTPUT_DIR}

deploy:
  box: node:latest
  steps:
    - script:
      name: copy to /usr/src/app
      code: |
        pwd
        ls -la ./
        mkdir -p /usr/app/src
        cp -r . /usr/app/src
        ls -la /usr/app/src
    - script:
      cwd: /usr/app/src
    - internal/docker-push:
        repository: schmidtp0740/moei_portals
        registry: https://registry.hub.docker.com/v2
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
        tag: ${WERCKER_GIT_BRANCH}-${WERCKER_GIT_COMMIT}
        cmd: npm run serve-prod
        ports: "3000"
