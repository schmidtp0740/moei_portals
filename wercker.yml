box:
 id: node:latest
 ports:
   - "3000"

build:
  steps:
    - script:
      name: copy source
      code: |
        cp -r . ${WERCKER_OUTPUT_DIR}
        ls -l ${WERCKER_OUTPUT_DIR}

deploy:
  box: node:8.9.4
  steps:
    - npm-install
    - script:
      name: copy to /app
      code: |
        pwd
        ls -la ./
        mkdir -p /app
        cp -r . /app
        ls -la /app
    - script:
      cwd: /app
    - internal/docker-push:
        repository: schmidtp0740/moei_portals
        registry: https://registry.hub.docker.com/v2
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
        tag: ${WERCKER_GIT_BRANCH}-${WERCKER_GIT_COMMIT}
        working-dir: /app
        cmd: npm start
        ports: "3000"
